#!/bin/bash

DB_NAME=drupal
DB_USER=drupal_user
DB_PASS=drupal_pass
DB_ROOTPASS=password

sudo add-apt-repository ppa:ondrej/php5 -y 
sudo apt-get update -y 
echo "mysql-server mysql-server/root_password password ${DB_ROOTPASS}" | sudo debconf-set-selections
echo "mysql-server mysql-server/root_password_again password ${DB_ROOTPASS}" | sudo debconf-set-selections

sudo apt-get install php5 libapache2-mod-php5 php5-mysql mysql-server php5-gd apache2 -y

wget http://ftp.drupal.org/files/projects/drupal-8.0.0-beta3.tar.gz
tar zxf drupal-8.0.0-beta3.tar.gz
mv drupal-8.0.0-beta3/* /var/www/html/
cd /var/www/html/sites/default/
mkdir files
cp default.settings.php settings.php
cp default.services.yml services.yml
chmod go+w settings.php services.yml
chown -R www-data files
mv /var/www/html/index.html /var/www/html/index.html.org

cat << EOF > install_db.sql
CREATE DATABASE ${DB_NAME} CHARACTER SET utf8;

GRANT ALL PRIVILEGES ON ${DB_NAME}.* TO '${DB_USER}'@'%' IDENTIFIED BY '${DB_PASS}';
GRANT ALL PRIVILEGES ON ${DB_NAME}.* TO '${DB_USER}'@'localhost' IDENTIFIED BY '${DB_PASS}';
EOF

mysql -u root -p${DB_ROOTPASS} <install_db.sql

